<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Лабораторна 3 - Аеропорт (JPA)</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 90%; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background-color: #f0f0f0; }
        form { background-color: #f9f9f9; border: 1px solid #ccc; padding: 15px; width: 90%; border-radius: 8px; }
        input[type="text"] { width: 200px; padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
        button { padding: 8px 15px; border-radius: 4px; border: none; cursor: pointer; background-color: #007bff; color: white;}
        .delete-link { color: red; text-decoration: none; margin-left: 10px; }
        .edit-link { color: #0069d9; text-decoration: none; }
    </style>
</head>
<body>

    <div style="position: absolute; top: 10px; right: 20px; text-align: right;">
        <div sec:authorize="isAuthenticated()">
            Вітаємо, <strong sec:authentication="name">User</strong>!
            (Роль: <span sec:authentication="principal.authorities">ROLE</span>)
            
            <form th:action="@{/logout}" method="post" style="display:inline; border:none; padding:0; box-shadow:none;">
                <button type="submit" style="background-color: #dc3545; margin-left: 10px;">Вийти</button>
            </form>
        </div>
        <div sec:authorize="isAnonymous()">
            <a th:href="@{/login}">Увійти</a>
        </div>
    </div>

    <h2>Лабораторна робота 3 (Захищений спосіб - Spring Data JPA)</h2>
    
    <div sec:authorize="hasRole('ADMIN')">
        <h3>Додати новий рейс (Безпечно)</h3>
        <form th:action="@{/add-flight}" method="POST" th:object="${newFlight}">
            <label>Місто:</label>
            <input type="text" th:field="*{city}" required />
            
            <label style="margin-left: 10px;">Країна:</label>
            <input type="text" th:field="*{country}" required />
            
            <label style="margin-left: 10px;">Номер рейсу:</label>
            <input type="text" th:field="*{flightNumber}" required />
            
            <button type="submit" style="margin-left: 10px;">Додати</button>
        </form>
        <br>
    </div>

    <h3>Список рейсів у базі:</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Місто</th>
                <th>Країна</th>
                <th>Номер рейсу</th>
                <th sec:authorize="hasRole('ADMIN')">Дія</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="flight : ${flights}">
                <td th:text="${flight.id}">1</td>
                <td th:text="${flight.city}">Київ</td>
                <td th:text="${flight.country}">Україна</td>
                <td th:text="${flight.flightNumber}">PS-001</td>
                <td sec:authorize="hasRole('ADMIN')">
                    <a th:href="@{/edit-flight(id=${flight.id})}" class="edit-link">Редагувати</a>
                    <a th:href="@{/delete-flight(id=${flight.id})}" class="delete-link">Видалити</a>
                </td>
            </tr>
        </tbody>
    </table>

</body>
</html>